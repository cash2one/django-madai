{% extends 'website/website.base.inc.html' %}
{% load static %}
{% block title %} 小麻袋 {% endblock title %}


{% block extracss %}
<link rel="stylesheet" href="{% static 'website/styles/app.css' %}" media="screen"/>
<link rel="stylesheet" href="{% static 'website/styles/fotorama.css' %}" media="screen"/>
<link rel="stylesheet" href="{% static 'libs/chosen_v1.1.0/chosen.min.css' %}" />
{% endblock extracss %}

{% block extraincjs %}
<script src="{% static 'website/scripts/libs/fotorama.js' %}"></script>
<script src="{% static 'website/scripts/libs/metro-calendar.js' %}"></script>
<script src="{% static 'website/scripts/libs/metro-datepicker.js' %}"></script>
<script src="{% static 'website/scripts/libs/jquery.jcarousel.min.js' %}"></script>
<script src="{% static 'libs/chosen_v1.1.0/chosen.jquery.min.js' %}"></script>
{% endblock extraincjs %}

{% block main_content %}
<header>
  <div class="account">
    <div class="grid fluid margin-0-center" style="width: 1000px;">
      <div class="row">
        <div style="float: right;">
          {% if user.is_authenticated %}
            <p class="account-info">欢迎 {{ user.name }} | <a href="{% url 'website:customer:logout' %}">登出</a></p>
            <div class="contact-info fg-white">
                <span class="icon-help on-left contact-hover"></span>
                <span class="contact-hover">需要帮助？</span>
                <div class="balloon bottom"><p class="text-center fg-grayDark">客服热线：028-65290911</p></div>
            </div>
          {% else %}
            <p class="account-info"><a id="signup-btn" href="#">注册</a> | <a id="signin-btn" href="#">登陆</a></p>
            <div class="contact-info fg-white">
                <span class="icon-help on-left contact-hover"></span>
                <span class="contact-hover">需要帮助？</span>
                <div class="balloon bottom"><p class="text-center fg-grayDark">客服热线：028-65290911</p></div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  <div class="logo text-center">
    <div class="inline text-center">
      <div class="header prefix fg-white">小麻袋</div>
      <img src="{% static 'website/img/logo.png' %}" alt=""/>
      <div class="header suffix fg-white">装满爱</div>
    </div>
  </div>
  <div class="date-pick">
    <div class="margin-0-center" style="width: 700px;">
      <div class="input-control select" style="display: inline-block; width: 238px; margin-right: 3px;">
        <select id="start_address" data-placeholder="出发城市" class="alt-select">
          <option value=""></option>
          <option value="成都">成都</option>
          <option value="重庆">重庆</option>
        </select>
        <i class="icon-location fg-grayLight"></i>
      </div>
      <div class="input-control select" style="display: inline-block; width: 160px;">
        <select id="price"  data-placeholder="预算范围(两人)" class="alt-select">
          <option value=""></option>
          <option value="20000-25000">&yen;20000 - &yen;25000</option>
          <option value="25000-30000">&yen;25000 - &yen;30000</option>
          <option value="35000-40000">&yen;35000 - &yen;40000</option>
          <option value="40000+">&yen;40000+</option>
        </select>
        <i class="icon-dollar fg-grayLight"></i>
      </div>
      <div class="input-control text" style="display: inline-block; width: 160px; margin-left: -1px;"
           data-role="datepicker"
           data-format='yyyy-mm-dd'
           data-effect="fade"
           data-locale="zhCN">
        <input type="text" id="start_date" name="start_date" class="fg-gray" placeholder="入住日期">
        <button class="btn-date fg-grayLight"></button>
      </div>
      <a id="search-btn" class="button large search-btn" href="#">搜索</a>
    </div>
  </div>
  <div class="fotorama" style="position:relative; z-index: 0;"
       data-autoplay="5000"
       data-width="100%"
       data-transition="dissolve"
       data-arrows="false"
       data-transitionduration="1000">
      {% for h_banner in hotel_banners %}
      <div data-img="{{ h_banner.image_url }}" data-fit="cover">
        <a href="{% url 'website:hotel:hotel_detail' h_banner.id %}" class="banner-link" >{{ h_banner.name }}<span class="icon-arrow-right-4 on-right"></span></a>
      </div>
      {% endfor %}
      <div data-img="{% static 'website/img/ss_home_7_7_24.jpg' %}" data-fit="cover">
        <a href="{% url 'website:present:present_list' %}" class="banner-link">更多礼包<span class="icon-arrow-right-4 on-right"></span></a>
      </div>
  </div>
</header>
<nav class="bg-white shadow-bottom menu">
  <div class="nav-box fixed-width margin-0-center">
    <a class="text-center" href="{% url 'website:index' %}"><p class="margin-0">首页</p></a>
    <a class="text-center" href="{% url 'website:hotel:hotel_list' %}"><p class="margin-0">酒店</p></a>
    <a class="text-center" href="{% url 'website:flight:flight_list' %}"><p class="margin-0">航班</p></a>
    <a class="text-center" href="#"><p class="margin-0">小麻袋库</p></a>
    <a class="text-center" href="#"><p class="margin-0">出行事项</p></a>
  </div>
</nav>
<section class="bg-darkCyan bg-image-white-light">
  <div class="bottom-shade-large"></div>
  <article>
    <h2 class="fg-white category-title">最新促销</h2>
    <a class="category-showmore place-right" href="{% url 'website:hotel:hotel_list' %}">+ 更多</a>
    <div class="product-group">
      <div class="jcarousel">
        <ul>
          {% for hotel in hotels %}
            <li>
              <a class="product" href="{% url 'website:hotel:hotel_detail' hotel.id %}">
                <img src="{{ hotel.image_url }}" />
                <div class="product-title">
                  <h4>{{ hotel.name }}</h4>
                  <p>&nbsp;</p>
                  <div class="customer-icon hotel-flat"></div>
                </div>
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
      <!-- Prev/next controls -->
      <i class="jcarousel-control-prev icon-arrow-left-5"></i>
      <i class="jcarousel-control-next icon-arrow-right-5"></i>
    </div>
  </article>
</section>
<section class="bg-3">
  <article>
    <h2 class="fg-white category-title">小麻袋礼</h2>
    <a class="category-showmore place-right" href="{% url 'website:present:present_list' %}">+ 更多</a>
    <div class="product-group">
      <div class="jcarousel">
        <ul>
          {% for present in presents %}
            <li>
              <a class="product" href="#">
                <img src="{{ present.image_url }}" />
                <div class="product-title">
                  <h4>{{ present.name }}</h4>
                  <p>&nbsp;</p>
                </div>
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
      <!-- Prev/next controls -->
      <i class="jcarousel-control-prev icon-arrow-left-5"></i>
      <i class="jcarousel-control-next icon-arrow-right-5"></i>
    </div>
  </article>
</section>
<section class="bg-white">
  <article>
    <h2 class="fg-orange category-title">种草专区</h2>
{#    <a class="category-showmore place-right" href="#">+ 更多</a>#}
    <div class="product-group">
      <div class="jcarousel">
        <ul>
          {% for travel_note in travel_notes %}
            <li>
              <a class="travel-note" href="{% url 'website:share:travelnote_detail' travel_note.id %}">
              <div class="cover">
                <h1>{{ travel_note.title }}</h1>
                <img class="cycle" src="{{ travel_note.image_url }}" />
                <div class="summary"><p class="fg-grayLight">{{ travel_note.fake_user }}</p></div>
              </div>
{#              <div class="bg-white" style="position: absolute; z-index: 1; width: 320px; height: 300px; top: 0;"></div>#}
              <div class="bg-white" style="position: absolute; z-index: 1; width: 120px; height: 5px; top: 345px;"></div>
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
      <!-- Prev/next controls -->
      <i class="jcarousel-control-prev icon-arrow-left-5"></i>
      <i class="jcarousel-control-next icon-arrow-right-5"></i>
    </div>
  </article>
</section>
{% endblock main_content %}

{% block extrajs %}
  <script type="text/javascript">
    $(document).ready(function() {
      $('#signup-btn').on('click', function(){
        $.Dialog({
          overlay: true,
          shadow: true,
          flat: true,
          onShow: function(_dialog){
            var content = '' +
            '<div class="signup-dialog">' +
            '<div class="ladding-img place-left">' +
            '  <h1 class="fg-white">加入<br/>小麻袋</h1>' +
            '</div>' +
            '<div class="signup-form place-left bg-white">' +
            '  <form id="signup_form" action="' + "{% url 'website:customer:signup' %}" + '" method="post" >' + "{% csrf_token %}" +
            '    <fieldset>' +
            '      <label for="" class="title">小麻袋注册 <a href="#" onclick="closeAndOpenDialog(\'signin-btn\');" class="place-right fg-color-pink">会员登录</a></label>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <p class="text-right" style="display: inline-block; width: 75px;">用户名：</p>' +
            '        <input id="id_name" name="name" type="text" style="display: inline; width: 216px;">' +
            '      </div>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <p class="text-right" style="display: inline-block; width: 75px;">手机号：</p>' +
            '        <input id="id_phone" name="phone" type="text" style="display: inline; width: 216px">' +
            '      </div>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <p class="text-right" style="display: inline-block; width: 75px;">密码：</p>' +
            '        <input id="id_password1" name="password1" type="password" style="display: inline; width: 216px">' +
            '      </div>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <p class="text-right" style="display: inline-block; width: 75px;">确认密码：</p>' +
            '        <input id="id_password2" name="password2" type="password" style="display: inline; width: 216px">' +
            '      </div>' +
            '      <button type="submit" onclick="signupSubmit();" class="ribbon place-right oblique bg-color-pink">' +
            '        <span class="fg-white">注册</span>' +
            '      </button>' +
            '    </fieldset>' +
            '  </form>' +
            '</div>' +
            '<div class="clearfix"></div>' +
            '</div>';
            $.Dialog.content(content);
            _dialog.children('.content').attr('style', 'padding: 32px 0 0;');
            $.Metro.initInputs();
          }
        });
      });

      $('#signin-btn').on('click', function() {
        $.Dialog({
          overlay: true,
          shadow: true,
          flat: true,
          onShow: function(_dialog){
            var content = '' +
            '<div class="signup-dialog">' +
            '<div class="ladding-img place-left">' +
            '  <h1 class="fg-white">欢迎回到<br/>小麻袋</h1>' +
            '</div>' +
            '<div class="signup-form place-left bg-white">' +
            '  <form id="signin_form" action="' + "{% url 'website:customer:signin' %}" + '" method="post" >' + "{% csrf_token %}" +
            '    <fieldset>' +
            '      <label for="" class="title">小麻袋登陆 <a href="#" onclick="closeAndOpenDialog(\'signup-btn\');" class="place-right fg-color-pink">还不是会员？</a></label>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <p class="text-right" style="display: inline-block; width: 75px;">用户名：</p>' +
            '        <input id="id_name" name="name" type="text" style="display: inline; width: 216px">' +
            '      </div>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <p class="text-right" style="display: inline-block; width: 75px;">密码：</p>' +
            '        <input id="id_password" name="password" type="password" style="display: inline; width: 216px">' +
            '      </div>' +
            '      <button type="submit" onclick="signinSubmit()" class="ribbon place-right oblique bg-color-pink">' +
            '        <span class="fg-white">登陆</span>' +
            '      </button>' +
            '    </fieldset>' +
            '  </form>' +
            '</div>' +
            '<div class="clearfix"></div>' +
            '</div>';
            $.Dialog.content(content);
            _dialog.children('.content').attr('style', 'padding: 32px 0 0;');
            $.Metro.initInputs();
          }
        });
      });

      $('#search-btn').on('click', function() {
        var start_address = $('#start_address').val();
        var start_date = $('#start_date').val();
        var priceRange = encodeURIComponent($('#price').val());
        if (!start_address || !price || !start_date) {
          return false;
        }
        window.location.href = '{% url 'website:package:package_searching' %}?' +
          'start_address=' + start_address +
          '&start_date=' + start_date +
          '&price_range=' + priceRange;
        return false;
      });

      $('header > .account .balloon.bottom').hide();
      var intervalId;
      $('.contact-hover')
        .on('mouseover', function() {
          if (intervalId) {
            clearInterval(intervalId);
          }
          $('header > .account .balloon.bottom').show();
        })
        .on('mouseleave', function() {
          intervalId = setInterval(function() {
            $('header > .account .balloon.bottom').hide();
          }, 500);
        });
      $('header > .account .balloon.bottom')
        .on('mouseover', function() {
          if (intervalId) {
            clearInterval(intervalId);
          }
          $('header > .account .balloon.bottom').show();
        })
        .on('mouseleave', function() {
          intervalId = setInterval(function() {
            $('header > .account .balloon.bottom').hide();
          }, 500);
        });

      var chosenOptions = {
        disable_search: true,
        inherit_select_classes: true
      }
      $('#start_address').chosen(chosenOptions);
      $('#price').chosen(chosenOptions);
    });

    function signinSubmit() {
      var $signin_form = $('#signin_form');

      $signin_form.submit(function() {
        var validator = $signin_form.validate();
        $(this).ajaxSubmit({
          success: function(data) {
            if (data && data['ret'] > 0) {
              validator.showErrors(data['errmsg-detail']);
            } else {
              location.reload();
            }
          }
        });
        return false;
      });
    }

    function signupSubmit() {
      var $signup_form = $('#signup_form');

      $signup_form.submit(function() {
        var validator = $signup_form.validate();
        $(this).ajaxSubmit({
          success: function(data) {
            if (data && data['ret'] > 0) {
              validator.showErrors(data['errmsg-detail']);
            } else {
              location.reload();
            }
          }
        });
        return false;
      });
    }

    (function($) {
      $(function() {
        /*
        Carousel initialization
        */
        $('.jcarousel')
            .jcarousel({
                // Options go here
            });

        /*
         Prev control initialization
         */
        $('.jcarousel-control-prev')
            .on('jcarouselcontrol:active', function() {
                $(this).removeClass('inactive');
            })
            .on('jcarouselcontrol:inactive', function() {
                $(this).addClass('inactive');
            })
            .jcarouselControl({
                // Options go here
                target: '-=1'
            });

        /*
         Next control initialization
         */
        $('.jcarousel-control-next')
            .on('jcarouselcontrol:active', function() {
                $(this).removeClass('inactive');
            })
            .on('jcarouselcontrol:inactive', function() {
                $(this).addClass('inactive');
            })
            .jcarouselControl({
                // Options go here
                target: '+=1'
            });
      });
    })(jQuery);

    function closeAndOpenDialog(toOpen) {
      $.Dialog.close();
      $('#' + toOpen).trigger('click');
    }

  </script>
{% endblock extrajs %}
