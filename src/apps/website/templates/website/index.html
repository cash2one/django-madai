{% extends 'website/website.base.inc.html' %}
{% load static %}
{% block title %} 小麻袋 {% endblock title %}


{% block extracss %}
<link rel="stylesheet" href="{% static 'website/styles/app.css' %}" media="screen"/>
<link rel="stylesheet" href="{% static 'website/styles/fotorama.css' %}" media="screen"/>
{% endblock extracss %}

{% block extraincjs %}
<script src="{% static 'website/scripts/libs/fotorama.js' %}"></script>
<script src="{% static 'website/scripts/libs/metro-calendar.js' %}"></script>
<script src="{% static 'website/scripts/libs/metro-datepicker.js' %}"></script>
{% endblock extraincjs %}

{% block main_content %}
<header>
  <div class="fotorama"
       data-autoplay="5000"
       data-width="100%"
       data-transition="dissolve"
       data-arrows="false"
       data-transitionduration="1000">
    <img src="{% static 'website/img/ss_home_7_7_31.jpg' %}" data-fit="cover"/>
    <img src="{% static 'website/img/ss_home_7_7_32.jpg' %}" data-fit="cover"/>
    <img src="{% static 'website/img/ss_home_7_7_24.jpg' %}" data-fit="cover"/>
    <img src="{% static 'website/img/ss_home_7_7_25.jpg' %}" data-fit="cover"/>
  </div>
  <div class="account">
    <div class="grid fluid">
      <div class="row">
        <div class="span3 offset8">
          {% if user.is_authenticated %}
            <p>欢迎 {{ user.name }} | <a href="{% url 'website:customer:logout' %}">登出</a></p>
          {% else %}
            <p><a id="signup-btn" href="#">注册</a> | <a id="signin-btn" href="#">登陆</a></p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  <div class="logo">
    <h1 class="fg-white text-center">小麻袋</h1>
  </div>
  <div class="date-pick">
    <div class="margin-0-center">
      <div class="grid fluid">
        <div class="row">
          <div class="span2 offset2">
            <div class="input-control text">
              <input type="text" id="start_address" name="start_address" class="fg-gray location" placeholder="出发城市" />
              <i class="icon-location fg-grayLight"></i>
            </div>
          </div>
          <div class="span2">
            <div class="input-control text"
                 data-role="datepicker"
                 data-format='yyyy-mm-dd'
                 data-effect="fade"
                 data-locale="zhCN">
              <input type="text" id="leave_date" name="leave_date" class="fg-gray" placeholder="离开日期">
              <button class="btn-date fg-grayLight"></button>
            </div>
          </div>
          <div class="span2">
            <div class="input-control text">
              <input type="text" id="price_min" name="price_min" class="fg-gray location" placeholder="最低金额" />
              <i class="icon-dollar fg-grayLight"></i>
            </div>
          </div>
          <div class="span2">
            <div class="input-control text">
              <input type="text" id="price_max" name="price_max" class="fg-gray location" placeholder="最高金额" />
              <i class="icon-dollar fg-grayLight"></i>
            </div>
            <a id="search-btn" class="button large search-btn" href="#">搜索</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
<nav class="bg-white shadow-bottom menu">
  <div class="nav-box fixed-width margin-0-center">
    <a class="text-center" href="{% url 'website:index' %}"><p class="margin-0">首页</p></a>
    <a class="text-center" href="#"><p class="margin-0">酒店</p></a>
    <a class="text-center" href="#"><p class="margin-0">航班</p></a>
  </div>
</nav>
<section class="bg-1 bg-image-white-light">
  <div class="bottom-shade-large"></div>
  <article>
    <h2 class="fg-white category-title">酒店</h2>
    <a class="category-showmore place-right" href="{% url 'website:hotel:hotel_list' %}">+ 更多</a>
    <div class="product-group">
      {% for hotel in hotels %}
        <a class="product place-left" href="{% url 'website:hotel:hotel_detail' hotel.id %}">
          <img src="{{ hotel.image_url }}" />
          <div class="product-title">
            <h4>{{ hotel.name }}</h4>
            <p>马尔代夫</p>
            <div class="customer-icon hotel-flat"></div>
          </div>
        </a>
      {% endfor %}
    </div>
  </article>
</section>
<section class="bg-2">
  <article>
    <h2 class="fg-white category-title">航班</h2>
    <a class="category-showmore place-right" href="#">+ 更多</a>
    <div class="product-group">
      {% for flight in flights %}
        <a class="product place-left" href="{% url 'website:flight:flight_detail' flight.id %}">
          <img src="{{ flight.image_url }}" />
          <div class="product-title">
            <h4>{{ flight.name }}</h4>
            <p>马尔代夫</p>
            <div class="customer-icon flight-flat"></div>
          </div>
        </a>
      {% endfor %}
    </div>
  </article>
</section>
{#<section class="bg-3">#}
{#  <article>#}
{#    <h2 class="fg-white category-title">套餐</h2>#}
{#    <a class="category-showmore place-right" href="#">+ 更多</a>#}
{#    <div class="product-group">#}
{#      <a class="product place-left" href="#">#}
{#        <img src="{% static 'website/img/cms_11_989_bundle.jpg' %}" />#}
{#        <div class="product-title">#}
{#          <h4>普吉岛贝尔泳池别墅度假酒店</h4>#}
{#          <p>泰国，普吉岛</p>#}
{#        </div>#}
{#      </a>#}
{#      <a class="product place-left" href="#">#}
{#        <img src="{% static 'website/img/cms_11_989_bundle.jpg' %}" />#}
{#        <div class="product-title">#}
{#          <h4>普吉岛贝尔泳池别墅度假酒店</h4>#}
{#          <p>泰国，普吉岛</p>#}
{#        </div>#}
{#      </a>#}
{#      <a class="product place-left" href="#">#}
{#        <img src="{% static 'website/img/cms_11_989_bundle.jpg' %}" />#}
{#        <div class="product-title">#}
{#          <h4>普吉岛贝尔泳池别墅度假酒店</h4>#}
{#          <p>泰国，普吉岛</p>#}
{#        </div>#}
{#      </a>#}
{#    </div>#}
{#  </article>#}
{#</section>#}
{% endblock main_content %}

{% block extrajs %}
  <script type="text/javascript" src="{% static 'website/scripts/plugin/jquery-form/jquery-form.min.js' %}"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('#signup-btn').on('click', function(){
        $.Dialog({
          overlay: true,
          shadow: true,
          flat: true,
          onShow: function(_dialog){
            var content = '' +
            '<div class="signup-dialog">' +
            '<div class="ladding-img place-left">' +
            '  <h1 class="fg-white">加入<br/>小麻袋</h1>' +
            '</div>' +
            '<div class="signup-form place-left bg-white">' +
            '  <form id="signup_form" action="' + "{% url 'website:customer:signup' %}" + '" method="post" >' + "{% csrf_token %}" +
            '    <fieldset>' +
            '      <label for="" class="title">小麻袋注册 <a href="#" class="place-right fg-color-pink">会员登录</a></label>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <input id="id_name" name="name" type="text" placeholder="用户名">' +
            '      </div>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <input id="id_password1" name="password1" type="password" placeholder="密码">' +
            '      </div>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <input id="id_password2" name="password2" type="password" placeholder="确认密码">' +
            '      </div>' +
            '      <button type="submit" onclick="signupSubmit();" class="ribbon place-right oblique bg-color-pink">' +
            '        <span class="fg-white">注册</span>' +
            '      </button>' +
            '    </fieldset>' +
            '  </form>' +
            '</div>' +
            '<div class="clearfix"></div>' +
            '</div>';
            $.Dialog.content(content);
            _dialog.children('.content').attr('style', 'padding: 32px 0 0;');
            $.Metro.initInputs();
          }
        });
      });

      $('#signin-btn').on('click', function() {
        $.Dialog({
          overlay: true,
          shadow: true,
          flat: true,
          onShow: function(_dialog){
            var content = '' +
            '<div class="signup-dialog">' +
            '<div class="ladding-img place-left">' +
            '  <h1 class="fg-white">欢迎回到<br/>小麻袋</h1>' +
            '</div>' +
            '<div class="signup-form place-left bg-white">' +
            '  <form id="signin_form" action="' + "{% url 'website:customer:signin' %}" + '" method="post" >' + "{% csrf_token %}" +
            '    <fieldset>' +
            '      <label for="" class="title">小麻袋登陆 <a href="#" class="place-right fg-color-pink">还不是会员？</a></label>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <input id="id_name" name="name" type="text" placeholder="用户名">' +
            '      </div>' +
            '      <div class="input-control text" data-role="input-control">' +
            '        <input id="id_password" name="password" type="password" placeholder="密码">' +
            '      </div>' +
            '      <label for="" class="forget-password"><a href="#" class="text-muted">忘记您的密码？</a></label>' +
            '      <button type="submit" onclick="signinSubmit()" class="ribbon place-right oblique bg-color-pink">' +
            '        <span class="fg-white">登陆</span>' +
            '      </button>' +
            '    </fieldset>' +
            '  </form>' +
            '</div>' +
            '<div class="clearfix"></div>' +
            '</div>';
            $.Dialog.content(content);
            _dialog.children('.content').attr('style', 'padding: 32px 0 0;');
            $.Metro.initInputs();
          }
        });
      });

      $('#search-btn').on('click', function() {
        window.location.href = '{% url 'website:package:package_searching' %}?' +
          'start_address=' + $('#start_address').val() +
          '&leave_date=' + $('#leave_date').val() +
          '&price_min=' + $('#price_min').val() +
          '&price_max=' + $('#price_max').val();
        return false;
      });

    });

    function signinSubmit() {
      var $signin_form = $('#signin_form');

      $signin_form.submit(function() {
        var validator = $signin_form.validate();
        $(this).ajaxSubmit({
          success: function(data) {
            if (data && data['ret'] > 0) {
              validator.showErrors(data['errmsg-detail']);
            } else {
              location.reload();
            }
          }
        });
        return false;
      });
    }

    function signupSubmit() {
      var $signup_form = $('#signup_form');

      $signup_form.submit(function() {
        var validator = $signup_form.validate();
        $(this).ajaxSubmit({
          success: function(data) {
            if (data && data['ret'] > 0) {
              validator.showErrors(data['errmsg-detail']);
            } else {
              location.reload();
            }
          }
        });
        return false;
      });
    }
  </script>
{% endblock extrajs %}
